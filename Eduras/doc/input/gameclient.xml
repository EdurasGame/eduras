<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD Simplified DocBook XML V1.0//EN"
"http://www.oasis-open.org/docbook/xml/simple/1.0/sdocbook.dtd">
<article>
	<articleinfo>
		<title>Game client</title>
		<author>
			<firstname>Jannis</firstname>
			<surname>Mell</surname>
		</author>
	</articleinfo>

	<section>

		<title>What is game client?</title>
		<para>
			The game client handles all end-user related things. It
			organizes
			client-frame and networkmanager.
			After initialized by
			EdurasClient, it builds the connection between gui
			and logic on client
			side.
			In addition to mouse-related events, it also manages game camera
			and
			network events and passes them to gui.
			In the other direction, it
			reacts on user-interaction on gui and sends
			events to server.
		</para>
	</section>
	<section>
	    <title>Architecture</title>
	    <para>
	        The client architecture is currently under heavy development.
	        It became clear that logic and GUI were not as isolated as they should be.
	    </para>
	    <para>
	        In the following scheme you can see the current draft status
	        Note that this structure is not yet realized in code.
	    </para>
	    <figure>
			<title>Planned client architecture</title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/client-architecture.png" format="PNG" />
				</imageobject>
			</mediaobject>
		</figure>
	</section>
	<section>
		<title>Game client startup</title>
		<para>
			The following graph shows a startup-sequence of game client.
			This does
			not contain all special
			actions other classes perform, but
			rather gives a quick overview how
			initialization is done.
		</para>
		<figure>
			<title>Startup of game client</title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/client_startup.png" format="PNG" />
				</imageobject>
			</mediaobject>
		</figure>
	</section>
	<section>
		<title>Gui</title>
		<section>
			<title>Rendering process</title>
			<para>
				Understanding rendering process is not very easy. The following scheme
				makes logic control flow more understandable.
				The render thread calls render-method periodically. This makes calls
				on every gui elements, map and game objects.
			</para>
			<figure>
				<title>Rendering loop explained</title>
				<mediaobject>
					<imageobject>
						<imagedata fileref="images/renderingloop.png" format="PNG" />
					</imageobject>
				</mediaobject>
			</figure>
			<figure>
				<title>Sequence of rendering in client gui</title>
				<mediaobject>
					<imageobject>
						<imagedata fileref="images/renderingprocess.png" format="PNG" />
					</imageobject>
				</mediaobject>
			</figure>
		</section>
		<section>
			<title>Gui scaling</title>
			<para>
			    Gui scaling is currently done in a very simple way. We might have a
			    detailed look at this once it comes to render images. This scaling
			    method might stretch them.
			</para>
			<para>
				The graphic below describes the scaling process roughly. The following steps are taken:
			</para>
			<orderedlist>
			    <listitem>
			        <para>
			            At first, the map and its objects are rendered as normal. The scaling process
			            is <ulink url="http://docs.oracle.com/javase/1.4.2/docs/api/java/awt/Graphics2D.html#scale%28double,%20double%29">
			            done implicitly</ulink> while creating the graphics object.
			        </para>
			    </listitem>
			    <listitem>
			        <para>
			            Secondly, all interface elements like minimap and inventory are drawn onto a separate
			            graphics object. 
			        </para>
			    </listitem>
			    <listitem>
			        <para>
			            In the last step, the interface graphics from step 2 are drawn onto the scaled
			            map at current camera position. The result is presented to user by being drawn
			            onto the client frame.
			        </para>
			    </listitem>
			</orderedlist>
			<figure>
				<title>Gui scaling flow</title>
				<mediaobject>
					<imageobject>
						<imagedata fileref="images/gui-scaling.png" format="PNG" />
					</imageobject>
				</mediaobject>
			</figure>
		</section>
	</section>
</article>